# Summarizer

Automatically summarize Slack conversations with AI-powered decision and action tracking.

## Features

- **Thread Summarization**: Summarize specific Slack threads with `/summarize thread <timestamp>`
- **Channel Summarization**: Summarize recent channel messages with `/summarize channel [N]`
- **AI-Powered Analysis**: Uses OpenAI GPT to identify:
  - üìä Key Decisions
  - ‚úÖ Action Items (with assignees and deadlines)
  - ‚ùì Unresolved Questions
  - üí¨ Key Discussion Points
- **Smart Pattern Matching**: Advanced regex-based recognition of decision language, action assignments, and questions
- **User-Friendly Commands**: Simple slash commands with helpful error messages and validation
- **Robust Error Handling**: Fallback to pattern-based summaries if AI service is unavailable

## Installation

### Prerequisites

- Python 3.9 or higher
- Slack App with Bot Token
- OpenAI API Key

### Setup

1. Clone and install dependencies:
```bash
git clone <your-repo>
cd SlackBot
pip install -r requirements.txt
```

2. Create a Slack App:
   - Go to [Slack API Apps](https://api.slack.com/apps)
   - Create new app "From scratch"
   - Add bot token scopes: `channels:history`, `groups:history`, `chat:write`, `users:read`, `channels:read`
   - Install app to workspace

3. Configure environment variables:
```bash
cp .env.example .env
```

Edit `.env` with your credentials:
```env
SLACK_BOT_TOKEN=xoxb-your-bot-token
SLACK_SIGNING_SECRET=your-signing-secret
SLACK_APP_TOKEN=xapp-your-app-level-token
OPENAI_API_KEY=your-openai-api-key
```

4. Enable Socket Mode:
   - In Slack App settings, go to "Socket Mode"
   - Enable Socket Mode
   - Create App-Level Token with `connections:write` scope

5. Add Slash Commands:
   - Go to "Slash Commands" in your Slack App
   - Create command `/summarize`
   - No need for Request URL (using Socket Mode)

## Usage

### Commands

```bash
# Summarize a specific thread
/summarize thread 1234567890.123456

# Summarize last 50 messages in channel
/summarize channel 50

# Summarize messages since a date
/summarize channel since 2024-01-01

# Quick summary of recent activity
/summarize

# Show help
/summarize help
```

### Example Output

```
üìã Thread Summary (Aug 27, 2025, 10:30 AM)
Channel: #project-alpha | Messages: 15 | Participants: 4

üìä Key Decisions:
‚Ä¢ Agreed to proceed with Option B for the API integration
‚Ä¢ Decision to postpone Feature X development until Sprint 3

‚úÖ Action Items:
‚Ä¢ @JohnDoe: Create JIRA ticket for API integration Option B (Due: EOD Aug 28)
‚Ä¢ @JaneSmith: Prepare Feature Y dependencies brief for stand-up (Due: Aug 29 AM)

‚ùì Unresolved Questions:
‚Ä¢ What's the final timeline for user testing of the new UI?
‚Ä¢ Do we have sufficient QA resources for the next release cycle?

üí¨ Key Discussion Points:
‚Ä¢ API integration options comparison
‚Ä¢ Resource allocation for upcoming sprint

Generated by Summarizer
```

## Architecture

```
src/
‚îú‚îÄ‚îÄ main.py                  # Main app entry point
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îî‚îÄ‚îÄ slash_commands.py    # Slash command handlers
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ slack_service.py     # Slack API integration
‚îÇ   ‚îî‚îÄ‚îÄ ai_service.py        # OpenAI integration
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ message_parser.py    # Message parsing and pattern matching
‚îÇ   ‚îî‚îÄ‚îÄ summary_formatter.py # Output formatting
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ test_message_parser.py
    ‚îî‚îÄ‚îÄ test_summary_formatter.py
```

## Development

### Running the Bot

```bash
# Run the bot
python src/main.py

# Run tests
python test_bot.py

# Run pytest for unit tests
pytest src/tests/
```

### Testing

The bot includes comprehensive testing:

```bash
# Test all functionality without API keys
python test_bot.py

# Run specific unit tests
pytest src/tests/test_message_parser.py -v
pytest src/tests/test_summary_formatter.py -v
```

### Customizing AI Patterns

Modify pattern recognition in `src/utils/message_parser.py`:

```python
self.decision_patterns = [
    re.compile(r'(?:agreed?\s+(?:on|to)|decision:?\s*|let\'?s\s+go\s+with)', re.IGNORECASE),
    # Add your custom patterns
]
```

## Configuration

### Environment Variables

- `SLACK_BOT_TOKEN`: Bot User OAuth Token (required)
- `SLACK_SIGNING_SECRET`: Signing Secret (required)
- `SLACK_APP_TOKEN`: App-Level Token for Socket Mode (required)
- `OPENAI_API_KEY`: OpenAI API Key (required)

### Slack Permissions

Required OAuth Scopes:
- `channels:history` - Read channel messages
- `groups:history` - Read private channel messages
- `chat:write` - Post summary messages
- `users:read` - Get user information
- `channels:read` - Get channel information
- `commands` - Handle slash commands

## Deployment

### Heroku

```bash
heroku create your-slack-bot
heroku config:set SLACK_BOT_TOKEN=xoxb-...
heroku config:set SLACK_SIGNING_SECRET=...
heroku config:set SLACK_APP_TOKEN=xapp-...
heroku config:set OPENAI_API_KEY=...
git push heroku main
```

### Docker

```dockerfile
FROM python:3.9-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["python", "src/main.py"]
```

### Using pip install

For development installation:
```bash
pip install -e .
```

## Advanced Features

### Pattern-Based Fallback
- If OpenAI API is unavailable, the bot automatically falls back to regex-based pattern matching
- Robust decision, action item, and question detection without AI dependency

### Smart Message Parsing
- Handles Slack-specific formatting (mentions, links, channels)
- Extracts deadlines and timeframes from natural language
- User lookup caching for performance

### Comprehensive Testing
- Unit tests for all components
- Integration testing with sample data
- Error handling validation

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Run tests: `python test_bot.py`
5. Add tests for new functionality
6. Submit a pull request

## Troubleshooting

### Common Issues

1. **"Bot token is invalid"**
   - Verify `SLACK_BOT_TOKEN` starts with `xoxb-`
   - Ensure bot is installed in workspace

2. **"Thread timestamp not found"**
   - Copy thread link and extract timestamp from URL
   - Format: `1640995200.000100`

3. **"OpenAI API error"**
   - Check API key validity
   - Verify sufficient credits
   - Bot will fallback to pattern-based summarization

4. **"Missing permissions"**
   - Review OAuth scopes in Slack App settings
   - Reinstall app to workspace if needed

5. **"Import errors"**
   - Ensure you're running from the correct directory
   - Install dependencies: `pip install -r requirements.txt`

## License

MIT License - see LICENSE file for details.